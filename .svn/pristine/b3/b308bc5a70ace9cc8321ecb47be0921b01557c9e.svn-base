<ion-header>
    <ion-navbar>
        <ion-row *ngIf="isIos">
            <ion-col width-50>
                <div text-center>
                    <div class="ios-title">
                        History
                    </div>
                </div>
            </ion-col>
            <ion-col width-25>
                <ion-buttons class="mar-right6" end>
                    <button class="refresh" ion-button round icon-right color="secondary" (click)="loadHistory()">
                        Refresh
                        <ion-icon class="logout-hide" name="refresh"></ion-icon>
                    </button>
                </ion-buttons>
            </ion-col>
            <ion-col width-25>
                <ion-buttons class="mar-right6" end>
                    <button class="logout" ion-button round icon-right color="danger" (click)="logout()"> Logout
                        <ion-icon class="logout-hide" name="log-out"></ion-icon>
                    </button>
                </ion-buttons>
            </ion-col>
        </ion-row>
        <ion-row *ngIf="!isIos">
            <ion-title>History</ion-title>
            <ion-buttons class="mar-right6" end>
                <button class="refresh" ion-button round icon-right color="secondary" (click)="loadHistory()"> Refresh
                    <ion-icon name="refresh"></ion-icon>
                </button>
            </ion-buttons>
            <ion-buttons class="mar-right6" end>
                <button class="logout" ion-button round icon-right color="danger" (click)="logout()"> Logout
                    <ion-icon name="log-out"></ion-icon>
                </button>
            </ion-buttons>
        </ion-row>
    </ion-navbar>
</ion-header>

<ion-content>


    <div *ngIf="history">


        <ion-card *ngFor="let task of history.data; let i = index">
            <ion-card-header text-wrap class="task-card-header header-proj">
                {{task.job_name}}
            </ion-card-header>

            <ion-card-content *ngFor="let jobTasks of task.job_tasks; let j = index">

                <div class="task-card-content">
                    <h3 class="text-info">{{j + 1}}:  {{jobTasks.task_description}} </h3>
                    <h4 class="text-info mar-top10">Date: {{jobTasks.month}} {{jobTasks.day}}, {{jobTasks.year}} </h4>
                </div>

                <ion-row>

                    <ion-col>
                        <button *ngIf="displayOptions.proj === -1 || displayOptions.task !== j" class="details"
                                ion-button icon-left clear small (click)="displayTask(i, j)">
                            <ion-icon name="fa-chevron-circle-right"></ion-icon>
                            <div>More Details</div>
                        </button>
                        <button *ngIf="displayOptions.task === j" class="details" ion-button icon-left clear small
                                (click)="displayTask(i, j)">
                            <ion-icon name="fa-chevron-circle-down"></ion-icon>
                            <div>Hide Details</div>
                        </button>
                    </ion-col>


                </ion-row>

                <ion-row *ngIf="jobTasks.status === 'Laborer On Hold'">

                    <button class="btn-shadow" ion-button icon-left block color="secondary" (click)="resumeTask(i,j)">
                        Resume Task
                    </button>


                </ion-row>

                <div margin-vertical *ngIf="displayOptions.proj === i && displayOptions.task === j">
                    <h4>Crew</h4>
                    <ol>
                        <li *ngFor="let taskCrew of jobTasks.task_crew">
                            <div class="list-font">{{taskCrew.first_name}} {{taskCrew.last_name}}</div>
                            <button ion-button icon-left clear medium
                                    class="contractorPhoneNum"
                                    (click)="callPhone(taskCrew.phone)">
                                {{taskCrew.phone}}
                            </button>
                        </li>
                    </ol>

                    <div *ngFor="let materials of jobTasks.task_materials; let k = index">
                        <h4 *ngIf="k === 0">Materials</h4>
                        <ol>
                            <li>
                                <h5>{{materials.material_name}}</h5>

                                <h5>{{materials.supplier.name}}</h5>
                                <h5>{{materials.supplier.address}}</h5>
                                <h5>{{materials.supplier.city}} {{materials.supplier.state}},
                                    {{materials.supplier.zip}}</h5>
                                <button ion-button icon-left clear medium
                                    class="contractorPhoneNum"
                                    (click)="callPhone(materials.supplier.phone)">
                                {{materials.supplier.phone}}
                            </button>
                            </li>
                        </ol>
                    </div>
                    <h4>Notes</h4>
                    <ol>
                        <li *ngFor="let notes of jobTasks.task_user_log; let k = index">
                            <h5>Date: {{notes.month}} {{notes.day}}, {{notes.noteTime}}</h5>
                            <h5 class="mar-bot10">Notes: {{notes.notes}}</h5>
                            <!--<h5 class="mar-bot5">Click On The Image To Review</h5>-->
                            <div *ngIf="notes.fileData?.length > 0">
                                <div *ngFor="let images of notes.fileData; let m = index">
                                    <img src="{{images.file_name}}">
                                    <h5 class="img-margin">Image Details: {{images.notes}}</h5>
                                </div>


                            </div>
                        </li>
                    </ol>
                    <ion-row>
                        <button class="feedback" ion-button icon-left clear small
                                (click)="openFeedbackModal(jobTasks.id)">
                            <ion-icon name="fa-chatbubble"></ion-icon>
                            <div>Leave Feedback</div>
                        </button>
                    </ion-row>
                </div>
            </ion-card-content>


        </ion-card>


    </div>

</ion-content>

<!-- NO HISTORY || EMPTY STATE -->
<div ion-fixed class="fs-no-results-container" *ngIf="!history" style="color:#2d2d2d">
    <div class="content">
        <!--<ion-icon name="paper-plane"></ion-icon>-->
        <div class="fs-no-results-msg">There is currently<br/>no history here.</div>
        <div class="button-container">
            <button ion-button icon-right block clear color="secondary" (click)="loadHistory()">
                Refresh History
            </button>
        </div>
    </div>
</div>
