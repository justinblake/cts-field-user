<ion-header>
    <ion-navbar>
        <ion-row *ngIf="isIos">
            <ion-col width-50>
                <div text-center>
                    <div class="ios-title">
                        History
                    </div>
                </div>
            </ion-col>
            <ion-col width-25>
                <ion-buttons class="mar-right6" end>
                    <button class="refresh" ion-button round icon-right color="secondary" (click)="loadHistory()">
                        Refresh
                        <ion-icon class="logout-hide" name="refresh"></ion-icon>
                    </button>
                </ion-buttons>
            </ion-col>
        </ion-row>
        <ion-row *ngIf="!isIos">
            <ion-title>History</ion-title>
            <ion-buttons class="mar-right6" end>
                <button class="refresh" ion-button round icon-right color="secondary" (click)="loadHistory()"> Refresh
                    <ion-icon name="refresh"></ion-icon>
                </button>
            </ion-buttons>
        </ion-row>
    </ion-navbar>
</ion-header>

<ion-content>

    <div *ngIf="hasPaused">
        <div *ngFor="let task of pausedTasks; let a = index">
            <ion-card *ngIf="task.job_tasks.length > 0">
                <ion-card-header text-wrap class="task-card-header header-proj">
                    {{task.job_name}}
                </ion-card-header>

                <ion-card-content *ngFor="let jobTasks of task.job_tasks; let b = index">
                    <div class="task-card-content">
                        <h3 class="text-info">{{b + 1}}: {{jobTasks.task_description}} </h3>
                        <h4 class="date-info mar-top10">Date:
                            <span *ngIf="isIos">{{jobTasks.updatedTime | date:'mediumDate'}}</span>
                            <span *ngIf="!isIos">{{jobTasks.updatedTime | date:'mediumDate'}}</span>
                        </h4>
                        <div *ngIf="jobTasks.additional_notes.length > 0">
                            <h5 class="text-info">Additional Task Notes</h5>
                            <ul class="add-ul" *ngFor="let newNotes of jobTasks.additional_notes; let u = index">
                                <li class="more-notes">{{newNotes.notes}}</li>
                                <li class="notes-by">Added By: <strong>{{newNotes.employee.first_name}}
                                    {{newNotes.employee.last_name}}</strong> at <strong>
                                    <span *ngIf="isIos">{{adjustTime(newNotes.updatedTime) }}</span>
                                    <span *ngIf="!isIos">{{newNotes.updatedTime | date:'shortTime'}}</span>
                                </strong></li>
                            </ul>
                        </div>
                    </div>

                    <ion-row>
                        <ion-col>
                            <button *ngIf="pausedDisplayOptions.proj !== a || pausedDisplayOptions.task !== b" class="details"
                                    ion-button icon-left clear small (click)="expandPausedTask(a, b)">
                                <ion-icon name="fa-chevron-circle-right"></ion-icon>
                                <div>More Details</div>
                            </button>
                            <button *ngIf="pausedDisplayOptions.task === b && pausedDisplayOptions.proj === a" class="details"
                                    ion-button icon-left clear small
                                    (click)="expandPausedTask(a, b)">
                                <ion-icon name="fa-chevron-circle-down"></ion-icon>
                                <div>Hide Details</div>
                            </button>
                        </ion-col>
                    </ion-row>

                    <ion-row>
                        <button class="btn-shadow" ion-button icon-left block color="secondary"
                                (click)="resumeTask(a,b)">
                            Resume Task
                        </button>
                    </ion-row>

                    <div margin-vertical *ngIf="pausedDisplayOptions.proj === a && pausedDisplayOptions.task === b">
                        <h4>Crew</h4>
                        <ol>
                            <li *ngFor="let taskCrew of jobTasks.task_crew">
                                <div class="list-font">{{taskCrew.first_name}} {{taskCrew.last_name}}</div>
                                <div class="list-font" *ngIf="taskCrew.is_foreman === 1">-- Foreman --</div>
                                <button ion-button icon-left clear medium
                                        class="contractorPhoneNum"
                                        (click)="callPhone(taskCrew.phone)">
                                    {{taskCrew.phone}}
                                </button>
                            </li>
                        </ol>
                        <div *ngFor="let materials of jobTasks.task_materials; let c = index">
                            <h4 *ngIf="c === 0">Materials</h4>
                            <ol>
                                <li>
                                    <h5>{{materials.material_name}}</h5>
                                    <h5>{{materials.supplier.name}}</h5>
                                    <h5>{{materials.supplier.address}}</h5>
                                    <h5>{{materials.supplier.city}} {{materials.supplier.state}},
                                        {{materials.supplier.zip}}</h5>
                                    <button ion-button icon-left clear medium
                                            class="contractorPhoneNum"
                                            (click)="callPhone(materials.supplier.phone)">
                                        {{materials.supplier.phone}}
                                    </button>
                                </li>
                            </ol>
                        </div>
                        <h4>Notes</h4>
                        <ol>
                            <li *ngFor="let notes of jobTasks.task_user_log">
                                <h5>Time:
                                    <span *ngIf="isIos">{{adjustTime(notes.updatedTime) }}</span>
                                    <span *ngIf="!isIos">{{notes.updatedTime | date:'shortTime'}}</span>
                                </h5>
                                <h5 class="mar-bot10">Notes: {{notes.notes}}</h5>
                                <div *ngIf="notes.fileData.length > 0">
                                    <h5 class="mar-bot5">Click On The Image To Review</h5>
                                    <div *ngFor="let images of notes.fileData">
                                        <img (click)="openImage(images)" src="{{images.file_name}}">
                                        <h5 class="img-margin">Image Details: {{images.notes}}</h5>
                                    </div>
                                </div>
                            </li>
                        </ol>
                    </div>
                </ion-card-content>
            </ion-card>
        </div>
    </div>

    <div *ngIf="history">
        <ion-card *ngFor="let task of history.data; let i = index">
            <ion-card-header text-wrap class="task-card-header header-proj">
                {{task.job_name}}
            </ion-card-header>

            <ion-card-content *ngFor="let jobTasks of task.job_tasks; let j = index">
                <div class="task-card-content">
                    <h3 class="text-info">{{j + 1}}: {{jobTasks.task_description}} </h3>
                    <h4 class="date-info mar-top10">Date:
                        <span *ngIf="isIos">{{jobTasks.updatedTime | date:'mediumDate'}}</span>
                        <span *ngIf="!isIos">{{jobTasks.updatedTime | date:'mediumDate'}}</span>
                    </h4>
                    <div *ngIf="jobTasks.additional_notes.length > 0">
                        <h5 class="text-info">Additional Task Notes</h5>
                        <ul class="add-ul" *ngFor="let newNotes of jobTasks.additional_notes; let u = index">
                            <li class="more-notes">{{newNotes.notes}}</li>
                            <li class="notes-by">Added By: <strong>{{newNotes.employee.first_name}}
                                {{newNotes.employee.last_name}}</strong> at <strong>
                                <span *ngIf="isIos">{{adjustTime(newNotes.updatedTime) }}</span>
                                <span *ngIf="!isIos">{{newNotes.updatedTime | date:'shortTime'}}</span>
                            </strong></li>
                        </ul>
                    </div>
                </div>

                <ion-row>
                    <ion-col>
                        <button *ngIf="displayOptions.proj !== i || displayOptions.task !== j" class="details"
                                ion-button icon-left clear small (click)="displayTask(i, j)">
                            <ion-icon name="fa-chevron-circle-right"></ion-icon>
                            <div>More Details</div>
                        </button>
                        <button *ngIf="displayOptions.task === j && displayOptions.proj === i" class="details"
                                ion-button icon-left clear small
                                (click)="displayTask(i, j)">
                            <ion-icon name="fa-chevron-circle-down"></ion-icon>
                            <div>Hide Details</div>
                        </button>
                    </ion-col>
                </ion-row>

                <!--<div margin-vertical *ngIf="displayOptions.proj === i && displayOptions.task === j">-->
                    <!--<h4>Crew</h4>-->
                    <!--<ol>-->
                        <!--<li *ngFor="let taskCrew of jobTasks.task_crew">-->
                            <!--<div class="list-font">{{taskCrew.first_name}} {{taskCrew.last_name}}</div>-->
                            <!--<div class="list-font" *ngIf="taskCrew.is_foreman === 1">&#45;&#45; Foreman &#45;&#45;</div>-->
                            <!--<button ion-button icon-left clear medium-->
                                    <!--class="contractorPhoneNum"-->
                                    <!--(click)="callPhone(taskCrew.phone)">-->
                                <!--{{taskCrew.phone}}-->
                            <!--</button>-->
                        <!--</li>-->
                    <!--</ol>-->
                    <!--<div *ngFor="let materials of jobTasks.task_materials; let k = index">-->
                        <!--<h4 *ngIf="k === 0">Materials</h4>-->
                        <!--<ol>-->
                            <!--<li>-->
                                <!--<h5>{{materials.material_name}}</h5>-->
                                <!--<h5>{{materials.supplier.name}}</h5>-->
                                <!--<h5>{{materials.supplier.address}}</h5>-->
                                <!--<h5>{{materials.supplier.city}} {{materials.supplier.state}},-->
                                    <!--{{materials.supplier.zip}}</h5>-->
                                <!--<button ion-button icon-left clear medium-->
                                        <!--class="contractorPhoneNum"-->
                                        <!--(click)="callPhone(materials.supplier.phone)">-->
                                    <!--{{materials.supplier.phone}}-->
                                <!--</button>-->
                            <!--</li>-->
                        <!--</ol>-->
                    <!--</div>-->
                    <!--<h4>Notes</h4>-->
                    <!--<ol>-->
                        <!--<li *ngFor="let notes of jobTasks.task_user_log; let k = index">-->
                            <!--<h5>Time:-->
                                <!--<span *ngIf="isIos">{{adjustTime(notes.updatedTime) }}</span>-->
                                <!--<span *ngIf="!isIos">{{notes.updatedTime | date:'shortTime'}}</span>-->
                            <!--</h5>-->
                            <!--<h5 class="mar-bot10">Notes: {{notes.notes}}</h5>-->
                            <!--<div *ngIf="notes.fileData.length > 0">-->
                                <!--<h5 class="mar-bot5">Click On The Image To Review</h5>-->
                                <!--<div *ngFor="let images of notes.fileData; let m = index">-->
                                    <!--<img (click)="openImage(images)" src="{{images.file_name}}">-->
                                    <!--<h5 class="img-margin">Image Details: {{images.notes}}</h5>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</li>-->
                    <!--</ol>-->
                    <!--<ion-row>-->
                        <!--<button class="feedback" ion-button icon-left clear small-->
                                <!--(click)="openHistoryFeedbackPage(jobTasks.id)">-->
                            <!--<ion-icon name="fa-chatbubble"></ion-icon>-->
                            <!--<div>Leave Feedback</div>-->
                        <!--</button>-->
                    <!--</ion-row>-->
                <!--</div>-->
            </ion-card-content>
        </ion-card>
    </div>

    <div *ngIf="!hasHistory && !hasPaused">
        <ion-card>
            <ion-card-header text-center class="task-card-header no-history">
                No Job History
            </ion-card-header>
        </ion-card>
    </div>


</ion-content>

